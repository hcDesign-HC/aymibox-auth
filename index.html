import React, { useState, useEffect } from 'react';
import { Mail, Lock, ArrowRight, CheckCircle, Sparkles, Tv, WashingMachine, Utensils, Wind, Refrigerator, Coffee, Eraser, ChefHat, X, ShoppingCart, Plus, Eye, Calendar, MousePointer2, Package, Armchair, Clock, ChevronRight, Check, Star, LayoutGrid, ArrowLeft, ChevronDown, ChevronUp, Trash2, Wallet, ShieldCheck, RefreshCcw, Leaf, Zap, HeartHandshake, Globe, FileText, HelpCircle, MapPin, Smartphone, ShoppingBag, CreditCard } from 'lucide-react';
import { initializeApp } from 'firebase/app';
import { getAuth, signInWithPopup, GoogleAuthProvider, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification, onAuthStateChanged, signOut } from 'firebase/auth';
import { getFirestore, doc, setDoc } from 'firebase/firestore';

// --- Firebase Config ---
const firebaseConfig = JSON.parse(__firebase_config || '{}');
const app = firebaseConfig.apiKey ? initializeApp(firebaseConfig) : null;
const auth = app ? getAuth(app) : null;
const db = app ? getFirestore(app) : null;

// --- VERİLER ---
const INITIAL_ORDERS = [
  {
    id: 'ord-1023',
    type: 'product', 
    name: '50" Smart TV',
    category: 'Televizyon',
    price: 1600,
    startDate: '2024-10-01',
    endDate: '2025-10-01',
    status: 'active',
    icon: <Tv size={24} />,
    progress: 15
  }
];

const PRODUCTS = [
  { id: 1, name: 'Televizyon', icon: <Tv className="w-12 h-12" />, models: [{ id: 'tv-40', name: '40" Smart TV', price: 1150 }, { id: 'tv-50', name: '50" Smart TV', price: 1600 }, { id: 'tv-55', name: '55" Smart TV', price: 2000 }] },
  { id: 2, name: 'Çamaşır Makinesi', icon: <div className="flex flex-col items-center"><div className="w-10 h-10 border-4 border-current rounded-lg flex items-center justify-center"><div className="w-6 h-6 border-2 border-current rounded-full animate-spin-slow"></div></div></div>, models: [{ id: 'wm-6', name: '6 kg Çamaşır Makinesi', price: 1150 }, { id: 'wm-7', name: '7 kg Çamaşır Makinesi', price: 1300 }, { id: 'wm-9', name: '9 kg Çamaşır Makinesi', price: 1500 }] },
  { id: 3, name: 'Bulaşık Makinesi', icon: <Utensils className="w-12 h-12" />, models: [{ id: 'dw-3', name: '3 Programlı', price: 1000 }, { id: 'dw-4', name: '4 Programlı', price: 1150 }, { id: 'dw-5', name: '5 Programlı', price: 1350 }] },
  { id: 4, name: 'Klima', icon: <Wind className="w-12 h-12" />, models: [{ id: 'ac-8', name: '8.000 BTU Klima', price: 1650 }, { id: 'ac-12', name: '12.000 BTU Klima', price: 2250 }, { id: 'ac-18', name: '18.000 BTU Klima', price: 3100 }] },
  { id: 5, name: 'Buzdolabı', icon: <Refrigerator className="w-12 h-12" />, models: [{ id: 'ref-off', name: 'Ofis Tipi Buzdolabı', price: 600 }, { id: 'ref-140', name: '140 cm Buzdolabı', price: 900 }, { id: 'ref-160', name: '160 cm Buzdolabı', price: 1150 }] },
  { id: 6, name: 'Kahve Makinesi', icon: <Coffee className="w-12 h-12" />, models: [{ id: 'cof-turk', name: 'Türk Kahve Makinesi', price: 250 }, { id: 'cof-filt', name: 'Filtre Kahve Makinesi', price: 400 }, { id: 'cof-auto', name: 'Otomatik Kahve Makinesi', price: 1500 }] },
  { id: 7, name: 'Süpürge', icon: <Eraser className="w-12 h-12" />, models: [{ id: 'vac-toz', name: 'Toz Torbasız Süpürge', price: 450 }, { id: 'vac-dik', name: 'Dik Süpürge', price: 900 }, { id: 'vac-robot', name: 'Robot Süpürge', price: 1150 }] },
  { id: 8, name: 'Airfryer', icon: <ChefHat className="w-12 h-12" />, models: [{ id: 'fry-s', name: 'Tek Hazne (Std)', price: 300 }, { id: 'fry-m', name: 'Tek Hazne (Pro)', price: 450 }, { id: 'fry-l', name: 'Çift Hazne', price: 700 }] },
];

const PLANS = [
  { id: 'basic', name: 'BASIC PAKET', price: 4000, slogan: 'Temel ihtiyaçlar için tam konfor.', description: 'Ev ve ofis için ideal başlangıç paketi.', target: 'YENİ YAŞAM KURANLAR', content: 'TV + Çamaşır + Bulaşık + Buzdolabı', includedProducts: ['40" Akıllı TV', '6 kg Çamaşır Makinesi', '3 Program Bulaşık Makinesi', 'Ofis Tipi Buzdolabı'], features: ['Peşinat Yok', '12 Ay Sabit Fiyat', 'Satın Alma Opsiyonu'], theme: 'light', buttonColor: 'bg-orange-500' },
  { id: 'plus', name: 'PLUS PAKET', price: 6000, slogan: 'Daha fazla güç. Daha fazla rahatlık.', description: 'Güçlü bir ev veya ofis setup’ı kurmak isteyenler için dengeli seçim.', target: 'KONFOR ARAYANLAR', content: 'TV + Çamaşır + Bulaşık + Buzdolabı + Robot Süpürge', includedProducts: ['50" Smart TV', '7 kg Çamaşır Makinesi', '4 Program Bulaşık Makinesi', '140 cm Buzdolabı', 'Robot Süpürge'], features: ['Peşinat Yok', '12 Ay Sabit Fiyat', 'Satın Alma Opsiyonu'], theme: 'dark', buttonColor: 'bg-orange-500' },
  { id: 'ultra', name: 'ULTRA PAKET', price: 8000, slogan: 'Her şey senin için hazır.', description: 'Premium ev ve ofisler için tam donanımlı çözüm.', target: 'PREMIUM OFİS & EVLER', content: 'TV + Çamaşır + Bulaşık + Buzdolabı + Robot Süpürge + Airfryer + Kahve', includedProducts: ['55" Smart TV', '9 kg Çamaşır Makinesi', '5 Program Bulaşık Makinesi', '160 cm Buzdolabı', 'Robot Süpürge', 'Tek Hazneli Airfryer', 'Türk Kahve Makinesi'], features: ['Peşinat Yok', '12 Ay Sabit Fiyat', 'Satın Alma Opsiyonu'], theme: 'darker', buttonColor: 'bg-yellow-400 text-black' },
  { id: 'custom', name: 'KENDİ PLANINI YAP', price: null, slogan: 'Özgürce Seç.', description: 'İhtiyaç duyduğun her şeyi bütçene göre belirle.', target: 'BİREYSEL İHTİYAÇLAR', content: 'Ürün listesinden dilediğini seç.', includedProducts: ['Dilediğin ürünleri seç', 'Esnek fiyatlandırma'], features: ['Peşinat Yok', '12 Ay Sabit Fiyat', 'Satın Alma Opsiyonu'], theme: 'dashed', buttonColor: 'bg-[#0E3C23]' }
];

const CUSTOM_OPTIONS = [
  { category: 'Televizyon', icon: <Tv size={18} />, options: [{ id: 'ctv-40', name: '40" Smart TV', price: 1150 }, { id: 'ctv-50', name: '50" Smart TV', price: 1600 }, { id: 'ctv-55', name: '55" Smart TV', price: 2000 }] },
  { category: 'Çamaşır Makinesi', icon: <div className="w-4 h-4 border-2 border-current rounded flex items-center justify-center"><div className="w-2 h-2 rounded-full bg-current"></div></div>, options: [{ id: 'cwm-6', name: '6 kg Çamaşır Mak.', price: 1150 }, { id: 'cwm-7', name: '7 kg Çamaşır Mak.', price: 1300 }, { id: 'cwm-9', name: '9 kg Çamaşır Mak.', price: 1500 }] },
  { category: 'Bulaşık Makinesi', icon: <Utensils size={18} />, options: [{ id: 'cdw-3', name: '3 Programlı', price: 1000 }, { id: 'cdw-4', name: '4 Programlı', price: 1150 }, { id: 'cdw-5', name: '5 Programlı', price: 1350 }] },
  { category: 'Buzdolabı', icon: <Refrigerator size={18} />, options: [{ id: 'cref-off', name: 'Ofis Tipi Buzdolabı', price: 600 }, { id: 'cref-140', name: '140 cm Buzdolabı', price: 900 }, { id: 'cref-160', name: '160 cm Buzdolabı', price: 1150 }] },
  { category: 'Temizlik', icon: <Eraser size={18} />, options: [{ id: 'ccl-toz', name: 'Toz Torbasız', price: 450 }, { id: 'ccl-dik', name: 'Dik Süpürge', price: 900 }, { id: 'ccl-robot', name: 'Robot Süpürge', price: 1150 }] },
  { category: 'Airfryer', icon: <ChefHat size={18} />, options: [{ id: 'caf-s', name: 'Tek Hazne (Std)', price: 300 }, { id: 'caf-m', name: 'Tek Hazne (Pro)', price: 450 }, { id: 'caf-l', name: 'Çift Hazne', price: 700 }] },
  { category: 'Kahve', icon: <Coffee size={18} />, options: [{ id: 'ccof-tr', name: 'Türk Kahve Mak.', price: 250 }, { id: 'ccof-flt', name: 'Filtre Kahve Mak.', price: 400 }, { id: 'ccof-auto', name: 'Otomatik Kahve Mak.', price: 1500 }] },
  { category: 'Klima', icon: <Wind size={18} />, options: [{ id: 'cac-8', name: '8.000 BTU Klima', price: 1650 }, { id: 'cac-12', name: '12.000 BTU Klima', price: 2250 }, { id: 'cac-18', name: '18.000 BTU Klima', price: 3100 }] }
];

// --- BİLEŞENLER ---

// Product Card - Geliştirilmiş Tıklama ve Z-Index Yönetimi
function ProductCard({ product, selectedModel, onSelect }) {
  const [isFlipped, setIsFlipped] = useState(false);

  const handleSelect = (model) => {
    onSelect(product.id, model);
    setIsFlipped(false);
  };

  return (
    <div 
      className="relative w-full h-80 perspective-1000 cursor-pointer group"
      onClick={() => !isFlipped && setIsFlipped(true)}
    >
      <div className={`relative w-full h-full transition-transform duration-700 transform-style-3d ${isFlipped ? 'rotate-y-180' : ''}`}>
        
        {/* ÖN YÜZ */}
        <div 
          className={`absolute w-full h-full bg-emerald-50 rounded-2xl shadow-md border border-emerald-100 backface-hidden flex flex-col items-center justify-center p-6 hover:shadow-2xl hover:border-emerald-300 hover:bg-emerald-100 transition-all duration-300 ${isFlipped ? 'z-0 pointer-events-none' : 'z-10 pointer-events-auto'}`}
        >
          <div className={`text-[#0E3C23] mb-6 transition-transform duration-300 ${selectedModel ? 'scale-75' : 'scale-100'}`}>
            {product.icon}
          </div>
          <h3 className="text-xl font-bold text-[#0E3C23] text-center mb-2">{product.name}</h3>
          
          {selectedModel ? (
            <div className="mt-2 bg-white px-4 py-2 rounded-lg border border-emerald-200 text-center shadow-sm w-full">
              <p className="text-xs text-slate-500 font-medium mb-1">Aylık Abonelik</p>
              <p className="text-sm text-emerald-800 font-medium line-clamp-1">{selectedModel.name}</p>
              <p className="text-lg font-bold text-[#0E3C23]">{selectedModel.price.toLocaleString('tr-TR')} ₺<span className="text-xs font-normal text-slate-400">/Ay</span></p>
            </div>
          ) : (
            <p className="text-emerald-600/70 text-sm font-medium mt-2 group-hover:text-[#0E3C23] transition-colors">Seç</p>
          )}
          
          {selectedModel && (
            <button 
              onClick={(e) => {
                e.stopPropagation();
                onSelect(product.id, null);
              }}
              className="absolute top-4 right-4 text-emerald-300 hover:text-red-500 p-1 hover:bg-red-50 rounded-full transition-all"
            >
              <X size={20} />
            </button>
          )}
        </div>

        {/* ARKA YÜZ */}
        <div 
          className={`absolute w-full h-full bg-[#0E3C23] text-white rounded-2xl shadow-xl rotate-y-180 backface-hidden overflow-hidden flex flex-col border border-[#092a18] ${isFlipped ? 'z-10 pointer-events-auto' : 'z-0 pointer-events-none'}`}
        >
          <div className="p-4 border-b border-white/10 flex justify-between items-center bg-[#092a18]">
            <h4 className="font-bold text-emerald-50">Model Seçin</h4>
            <button 
              onClick={(e) => {
                e.stopPropagation();
                setIsFlipped(false);
              }}
              className="p-1 hover:bg-white/10 rounded-full transition-colors text-emerald-200 hover:text-white"
            >
              <X size={20} />
            </button>
          </div>
          
          <div className="flex-1 overflow-y-auto p-2 space-y-2 scrollbar-thin scrollbar-thumb-emerald-600 scrollbar-track-transparent">
            {product.models.map((model) => (
              <div 
                key={model.id}
                onClick={(e) => {
                  e.stopPropagation();
                  handleSelect(model);
                }}
                className={`p-3 rounded-xl border cursor-pointer transition-all flex justify-between items-center group
                  ${selectedModel?.id === model.id 
                    ? 'bg-emerald-50 text-[#0E3C23] border-emerald-50' 
                    : 'bg-white/5 border-white/10 hover:bg-white/10 hover:border-emerald-400/50'
                  }`}
              >
                <div className="flex-1">
                  <p className={`font-medium text-sm ${selectedModel?.id === model.id ? 'text-[#0E3C23]' : 'text-emerald-50'}`}>{model.name}</p>
                </div>
                <div className="text-right">
                  <p className={`font-bold text-sm ml-2 whitespace-nowrap ${selectedModel?.id === model.id ? 'text-[#0E3C23]' : 'text-emerald-300 group-hover:text-white'}`}>{model.price.toLocaleString('tr-TR')} ₺</p>
                  <p className={`text-[10px] ${selectedModel?.id === model.id ? 'text-emerald-700' : 'text-emerald-400/60'}`}>Aylık</p>
                </div>
              </div>
            ))}
          </div>
        </div>

      </div>
    </div>
  );
}

// Plan Card - Geliştirilmiş Tıklama ve Z-Index Yönetimi
function PlanCard({ plan, isSelected, onSelect, customSelections, onCustomUpdate }) {
  const [isFlipped, setIsFlipped] = useState(false);
  const [expandedCategory, setExpandedCategory] = useState(null);
  const isDark = plan.theme === 'dark' || plan.theme === 'darker';
  const isDashed = plan.theme === 'dashed';
  const isCustom = plan.id === 'custom';

  const customTotalPrice = isCustom ? Object.values(customSelections).reduce((sum, item) => sum + item.price, 0) : 0;
  const customTotalItems = isCustom ? Object.keys(customSelections).length : 0;

  const frontClasses = `
    absolute w-full h-full backface-hidden
    flex flex-col rounded-3xl overflow-hidden transition-all duration-300
    ${isSelected ? 'ring-4 ring-emerald-500 shadow-2xl scale-[1.02]' : ''}
    ${plan.theme === 'light' ? 'bg-white border border-slate-200' : ''}
    ${plan.theme === 'dark' ? 'bg-[#0B1C3E] text-white border border-[#0B1C3E]' : ''}
    ${plan.theme === 'darker' ? 'bg-[#0B1120] text-white border border-[#0B1120]' : ''}
    ${isDashed ? 'bg-white border-2 border-dashed border-orange-500' : ''}
    ${isFlipped ? 'z-0 pointer-events-none' : 'z-10 pointer-events-auto'}
  `;

  const backClasses = `
    absolute w-full h-full backface-hidden rotate-y-180
    flex flex-col rounded-3xl overflow-hidden
    ${isSelected ? 'ring-4 ring-emerald-500' : ''}
    ${plan.theme === 'light' ? 'bg-white border border-slate-200' : ''}
    ${plan.theme === 'dark' ? 'bg-[#0B1C3E] text-white border border-[#0B1C3E]' : ''}
    ${plan.theme === 'darker' ? 'bg-[#0B1120] text-white border border-[#0B1120]' : ''}
    ${isDashed ? 'bg-white border-2 border-dashed border-orange-500' : ''}
    ${isFlipped ? 'z-10 pointer-events-auto' : 'z-0 pointer-events-none'}
  `;

  const badgeClasses = `text-[10px] font-bold px-3 py-1 rounded-full uppercase tracking-wider mb-4 inline-block ${plan.theme === 'light' ? 'bg-blue-50 text-blue-600' : ''} ${plan.theme === 'dark' ? 'bg-white text-orange-500' : ''} ${plan.theme === 'darker' ? 'bg-yellow-400 text-black' : ''} ${isDashed ? 'bg-orange-500 text-white' : ''}`;
  const textColor = isDark ? 'text-white' : 'text-[#0E3C23]';
  const subTextColor = isDark ? 'text-slate-300' : 'text-slate-500';
  const highlightColor = plan.theme === 'darker' ? 'text-yellow-400' : 'text-orange-500';

  const handlePlanClick = (e) => {
    e.stopPropagation();
    onSelect(plan.id);
  };

  const buttonText = isSelected ? 'SEÇİLDİ (İPTAL ET)' : (isCustom ? 'PLANINI TASARLA' : 'BU PAKETİ SEÇ');
  const buttonStyle = isSelected ? 'bg-emerald-600 hover:bg-emerald-700 text-white' : `${plan.buttonColor} text-white`;

  return (
    <div className="relative w-full h-[700px] perspective-1000 cursor-pointer group" onClick={() => !isFlipped && setIsFlipped(true)}>
      {isSelected && <div className="absolute -top-4 left-1/2 transform -translate-x-1/2 z-20 bg-emerald-500 text-white px-4 py-1 rounded-full shadow-lg flex items-center gap-1 text-sm font-bold animate-bounce"><Check size={16} /> SEÇİLDİ</div>}
      <div className={`relative w-full h-full transition-transform duration-700 transform-style-3d ${isFlipped ? 'rotate-y-180' : ''}`}>
        {/* FRONT */}
        <div className={frontClasses}>
          <div className="p-8 flex-1 flex flex-col">
            <div className="flex justify-between items-start"><div><h3 className={`font-extrabold text-lg ${textColor}`}>AYMIBOX</h3><span className={`text-xs ${subTextColor}`}>{plan.slogan}</span></div><span className={badgeClasses}>{plan.name}</span></div>
            <div className="my-6">{isCustom ? (customTotalItems > 0 ? (<div className="flex items-baseline gap-1"><span className={`text-4xl font-bold ${textColor}`}>{customTotalPrice.toLocaleString('tr-TR')} ₺</span><span className={`text-sm ${subTextColor}`}>/Ay</span><span className="text-xs bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded ml-2">{customTotalItems} Ürün</span></div>) : (<div className="flex items-center gap-2 mt-2"><LayoutGrid className="w-8 h-8 text-orange-500" /><span className={`text-2xl font-bold ${textColor}`}>Planını Tasarla</span></div>)) : (<div className="flex items-baseline gap-1"><span className={`text-4xl font-bold ${textColor}`}>{plan.price.toLocaleString('tr-TR')} ₺</span><span className={`text-sm ${subTextColor}`}>/Ay</span></div>)}</div>
            <p className={`text-sm mb-4 ${subTextColor} min-h-[40px]`}>{plan.description}</p>
            <div className="mb-6"><p className="text-[10px] font-bold text-slate-400 uppercase mb-1">HEDEF KİTLE</p><p className={`text-sm font-bold ${highlightColor} uppercase`}>{plan.target}</p></div>
            <div className={`p-4 rounded-xl mb-6 ${isDark ? 'bg-white/10' : 'bg-slate-50 border border-slate-100'}`}><p className="text-[10px] font-bold text-slate-400 uppercase mb-2">İÇERİK ÖZETİ</p>{isCustom && customTotalItems > 0 ? (<div className="flex flex-wrap gap-1">{Object.values(customSelections).map((item, i) => (<span key={i} className="text-[10px] bg-slate-200 px-2 py-1 rounded-md text-slate-700 line-clamp-1">{item.name}</span>))}</div>) : (<p className={`text-sm font-medium ${textColor}`}>{plan.content}</p>)}<p className={`text-xs mt-2 italic opacity-60 ${textColor}`}>{isCustom ? 'Düzenlemek için tıklayın →' : 'Detaylar için karta tıklayın →'}</p></div>
            <div className="space-y-3 mb-8 flex-1"><p className="text-[10px] font-bold text-slate-400 uppercase">AVANTAJLAR</p>{plan.features.slice(0, 3).map((feature, idx) => (<div key={idx} className="flex items-start gap-2"><div className={`mt-0.5 w-4 h-4 rounded-full flex items-center justify-center ${isDark ? 'bg-white/20 text-white' : 'bg-blue-50 text-blue-600'}`}><Check className="w-2.5 h-2.5" /></div><span className={`text-xs ${subTextColor}`}>{feature}</span></div>))}</div>
          </div>
          <button onClick={handlePlanClick} className={`w-full py-4 font-bold text-sm uppercase tracking-wide transition-colors hover:opacity-90 ${buttonStyle}`}>{buttonText}</button>
        </div>
        {/* BACK */}
        <div className={backClasses}>
          <div className="p-8 flex-1 flex flex-col h-full">
             <div className="flex justify-between items-center mb-6 border-b border-white/10 pb-4 flex-shrink-0"><h3 className={`font-bold text-lg ${textColor}`}>{isCustom ? 'Paketini Oluştur' : 'Paket İçeriği'}</h3><button onClick={(e) => { e.stopPropagation(); setIsFlipped(false); }} className={`p-1.5 rounded-full hover:bg-white/10 transition-colors ${textColor}`}><X size={20} /></button></div>
             <div className="flex-1 overflow-y-auto min-h-0 pr-2 scrollbar-thin scrollbar-thumb-slate-400 scrollbar-track-transparent">
                {isCustom ? (
                  <div className="space-y-3">{CUSTOM_OPTIONS.map((cat, idx) => { const selectedItem = customSelections[cat.category]; const isExpanded = expandedCategory === idx; return (<div key={idx} className={`rounded-xl overflow-hidden border ${selectedItem ? 'border-orange-300 bg-orange-50' : 'border-slate-200 bg-white'}`}><div onClick={(e) => { e.stopPropagation(); setExpandedCategory(expandedCategory === idx ? null : idx); }} className="flex items-center justify-between p-3 cursor-pointer hover:bg-slate-50 transition-colors"><div className="flex items-center gap-2 text-[#0E3C23]">{cat.icon}<span className="text-sm font-bold">{cat.category}</span></div><div className="flex items-center gap-2">{selectedItem && <span className="text-xs font-medium text-orange-600 bg-orange-100 px-2 py-0.5 rounded">{selectedItem.price} ₺</span>}{isExpanded ? <ChevronUp size={16} className="text-slate-400"/> : <ChevronDown size={16} className="text-slate-400"/>}</div></div>{(isExpanded || selectedItem) && (<div className={`px-3 pb-3 ${!isExpanded && 'hidden'}`}><div className="space-y-1 mt-2 border-t border-slate-100 pt-2">{cat.options.map((opt) => (<div key={opt.id} onClick={(e) => { e.stopPropagation(); onCustomUpdate(cat.category, opt); }} className={`flex justify-between items-center p-2 rounded-lg cursor-pointer text-xs ${selectedItem?.id === opt.id ? 'bg-orange-100 text-orange-800 font-bold' : 'hover:bg-slate-100 text-slate-600'}`}><span>{opt.name}</span><span>{opt.price} ₺</span></div>))}{selectedItem && <div onClick={(e) => { e.stopPropagation(); onCustomUpdate(cat.category, null); }} className="flex items-center gap-1 text-xs text-red-500 p-2 cursor-pointer hover:bg-red-50 rounded-lg mt-1 border-t border-dashed border-red-200"><Trash2 size={12} />Seçimi Temizle</div>}</div></div>)}</div>); })}</div>
                ) : (
                  <ul className="space-y-4">{plan.includedProducts.map((item, idx) => (<li key={idx} className={`flex items-center gap-3 p-3 rounded-xl ${isDark ? 'bg-white/5' : 'bg-slate-50'}`}><div className={`p-2 rounded-lg ${isDark ? 'bg-white/10 text-white' : 'bg-emerald-100 text-[#0E3C23]'}`}><Check size={16} /></div><span className={`text-sm font-medium ${textColor}`}>{item}</span></li>))}<div className="mt-6 pt-4 border-t border-white/10"><p className={`text-xs font-bold uppercase mb-3 ${subTextColor}`}>PAKET AVANTAJLARI</p><ul className="space-y-2">{plan.features.map((feature, idx) => (<li key={idx} className="flex items-start gap-2"><div className={`mt-0.5 w-3 h-3 rounded-full flex items-center justify-center ${isDark ? 'bg-white/20 text-white' : 'bg-blue-50 text-blue-600'}`}><Check className="w-2 h-2" /></div><span className={`text-xs ${subTextColor}`}>{feature}</span></li>))}</ul></div></ul>
                )}
             </div>
             <div className="mt-6 pt-6 border-t border-white/10 flex-shrink-0">
                <div className="flex justify-between items-center mb-4"><span className={`text-xs ${subTextColor}`}>Aylık Abonelik</span><span className={`text-xl font-bold ${textColor}`}>{isCustom ? (customTotalPrice > 0 ? `${customTotalPrice.toLocaleString('tr-TR')} ₺` : '0 ₺') : `${plan.price.toLocaleString('tr-TR')} ₺`}</span></div>
                <button onClick={handlePlanClick} disabled={isCustom && customTotalPrice === 0} className={`w-full py-3.5 font-bold text-sm rounded-xl shadow-lg transition-transform hover:-translate-y-1 ${buttonStyle} disabled:opacity-50 disabled:cursor-not-allowed`}>{isSelected ? 'SEÇİMİ KALDIR' : 'BU PAKETİ SEÇ'}</button>
                <button onClick={(e) => { e.stopPropagation(); setIsFlipped(false); }} className={`w-full mt-3 py-2 text-xs font-medium opacity-60 hover:opacity-100 flex items-center justify-center gap-1 ${textColor}`}><ArrowLeft size={14} />Geri Dön</button>
             </div>
          </div>
        </div>
      </div>
    </div>
  );
}

function HowItWorksStep({ icon, title, description, showArrow }) {
  return (
    <div className="flex flex-col items-center text-center relative flex-1 px-4">
      <div className="w-20 h-20 rounded-2xl bg-emerald-50 border-2 border-emerald-100 flex items-center justify-center mb-6 shadow-sm transform transition-transform hover:scale-105 hover:border-emerald-300"><div className="text-[#0E3C23]">{icon}</div></div>
      <h4 className="text-lg font-bold text-[#0E3C23] mb-2">{title}</h4><p className="text-sm text-slate-500 leading-relaxed max-w-[200px]">{description}</p>
      {showArrow && (<div className="hidden md:block absolute top-10 -right-1/2 w-full h-0.5 z-0"><svg className="w-full h-12 absolute top-1/2 left-1/2 -translate-y-1/2 -translate-x-1/2 pointer-events-none overflow-visible text-emerald-200" preserveAspectRatio="none"><path d="M 10 6 Q 50 -10 90 6" fill="none" stroke="currentColor" strokeWidth="2" strokeDasharray="6 6" /><polygon points="90,6 85,2 85,10" fill="currentColor" /></svg></div>)}
    </div>
  );
}

function FlexibilitySection() {
  return (
    <div className="bg-emerald-50 rounded-3xl p-8 md:p-12 border border-emerald-100 mb-20 overflow-hidden relative">
      <div className="absolute top-0 right-0 w-96 h-96 bg-emerald-200/30 rounded-full blur-3xl -translate-y-1/2 translate-x-1/3 pointer-events-none"></div>
      <div className="flex flex-col md:flex-row items-center gap-12 relative z-10">
        <div className="w-full md:w-1/2 flex justify-center">
          <div className="relative w-72 h-[500px] bg-[#0E3C23] rounded-[3rem] p-3 shadow-2xl transform rotate-[-3deg] hover:rotate-0 transition-transform duration-500 border-4 border-[#092315]">
            <div className="bg-white w-full h-full rounded-[2.5rem] overflow-hidden flex flex-col relative">
              <div className="absolute top-0 left-1/2 -translate-x-1/2 w-32 h-6 bg-[#0E3C23] rounded-b-2xl z-20"></div>
              <div className="pt-12 px-5 pb-6 flex-1 flex flex-col bg-slate-50">
                <div className="flex items-center justify-between mb-6"><div className="w-8 h-8 bg-emerald-100 rounded-full flex items-center justify-center"><div className="w-4 h-4 bg-emerald-600 rounded-full"></div></div><h4 className="text-[#0E3C23] font-bold">Siparişlerim</h4><div className="w-8"></div></div>
                <div className="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 mb-4"><div className="flex items-center gap-3 mb-2"><div className="w-10 h-10 bg-emerald-50 rounded-lg flex items-center justify-center text-emerald-600"><Tv size={20} /></div><div><p className="text-sm font-bold text-slate-800">50" Smart TV</p><p className="text-xs text-emerald-600 font-medium">Aktif Kiralama</p></div></div></div>
                <div className="mt-auto space-y-3"><div className="bg-emerald-50 p-3 rounded-xl border border-emerald-100 flex items-center justify-between group cursor-pointer hover:bg-emerald-100 transition-colors"><div className="flex items-center gap-3"><div className="bg-white p-2 rounded-lg text-emerald-600 shadow-sm"><Clock size={18} /></div><span className="text-sm font-bold text-[#0E3C23]">Kira süreni uzat</span></div><div className="bg-white p-1.5 rounded-full text-emerald-600 shadow-sm"><ChevronRight size={14} /></div></div><div className="bg-emerald-50 p-3 rounded-xl border border-emerald-100 flex items-center justify-between group cursor-pointer hover:bg-emerald-100 transition-colors"><div className="flex items-center gap-3"><div className="bg-white p-2 rounded-lg text-emerald-600 shadow-sm"><ShoppingBag size={18} /></div><span className="text-sm font-bold text-[#0E3C23]">Kiraladığını satın al</span></div><div className="bg-white p-1.5 rounded-full text-emerald-600 shadow-sm"><ChevronRight size={14} /></div></div></div>
                <div className="mt-6 flex justify-around text-slate-300"><div className="w-12 h-1 bg-slate-200 rounded-full"></div></div>
              </div>
            </div>
          </div>
        </div>
        <div className="w-full md:w-1/2 space-y-6">
          <h2 className="text-3xl md:text-4xl font-bold text-[#0E3C23] leading-tight">İster süreni uzat, <br /><span className="text-emerald-600">ister satın al.</span></h2>
          <div className="space-y-4 text-slate-600 text-lg leading-relaxed"><p>Kiralama süren başladıktan sonra <strong className="text-[#0E3C23]">siparişlerim</strong> sayfasından kira süreni kolayca uzatabilirsin.</p><p>Ya da kiraladığın cihazı çok mu sevdin? Onu ikinci el değeri üzerinden, ödediğin kiraların bir kısmını düşerek <strong className="text-[#0E3C23]">satın alabilirsin.</strong></p><div className="p-4 bg-white rounded-xl border border-emerald-100 shadow-sm inline-flex items-center gap-3 text-[#0E3C23] font-medium mt-2"><CheckCircle className="text-emerald-500" /><span>Önce Kirala, Dene, Sonra İstersen Al.</span></div></div>
        </div>
      </div>
    </div>
  );
}

// --- Siparişlerim ---
function OrdersView({ orders }) {
  return (
    <div className="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <h2 className="text-3xl font-bold text-[#0E3C23] mb-8 flex items-center gap-3"><Package className="text-emerald-600" size={32} />Siparişlerim ve Aboneliklerim</h2>
      <div className="space-y-6">
        {orders.length === 0 ? (
          <div className="text-center py-20 bg-slate-50 rounded-3xl border border-dashed border-slate-200">
            <ShoppingBag className="w-16 h-16 text-slate-300 mx-auto mb-4" />
            <h3 className="text-xl font-bold text-slate-600">Henüz bir aboneliğiniz yok.</h3>
          </div>
        ) : (
          orders.map((order) => (
            <div key={order.id} className="bg-white rounded-2xl p-6 border border-slate-200 shadow-sm hover:shadow-md transition-shadow">
              <div className="flex flex-col md:flex-row gap-6">
                <div className="flex items-start gap-4 md:w-1/3">
                  <div className="w-16 h-16 bg-emerald-50 rounded-xl flex items-center justify-center text-emerald-600 shrink-0">{order.icon}</div>
                  <div>
                    <div className="flex items-center gap-2 mb-1"><span className={`px-2 py-0.5 text-[10px] font-bold uppercase rounded-full ${order.type === 'package' ? 'bg-orange-100 text-orange-600' : 'bg-blue-100 text-blue-600'}`}>{order.type === 'package' ? 'PAKET' : 'ÜRÜN'}</span><span className={`px-2 py-0.5 text-[10px] font-bold uppercase rounded-full ${order.status === 'active' ? 'bg-green-100 text-green-600' : 'bg-yellow-100 text-yellow-600'}`}>{order.status === 'active' ? 'AKTİF' : 'SÜRE DOLUYOR'}</span></div>
                    <h3 className="text-lg font-bold text-[#0E3C23]">{order.name}</h3>
                    <p className="text-sm text-slate-500">{order.category}</p>
                    <p className="text-lg font-bold text-[#0E3C23] mt-2">{order.price.toLocaleString('tr-TR')} ₺<span className="text-xs font-normal text-slate-400">/Ay</span></p>
                  </div>
                </div>
                <div className="flex-1 flex flex-col justify-center border-t md:border-t-0 md:border-l border-slate-100 pt-4 md:pt-0 md:pl-6">
                  <div className="flex justify-between text-sm text-slate-500 mb-2"><span>Başlangıç: <strong className="text-slate-700">{order.startDate}</strong></span><span>Bitiş: <strong className="text-slate-700">{order.endDate}</strong></span></div>
                  <div className="w-full bg-slate-100 rounded-full h-2.5 mb-2"><div className={`h-2.5 rounded-full ${order.status === 'active' ? 'bg-emerald-500' : 'bg-yellow-500'}`} style={{ width: `${order.progress}%` }}></div></div>
                  <p className="text-xs text-slate-400 text-right">{order.progress}% Tamamlandı</p>
                  {order.items && <div className="mt-3"><p className="text-xs font-bold text-slate-500 mb-1">Paket İçeriği:</p><div className="flex gap-2 overflow-x-auto pb-1 scrollbar-thin">{order.items.map((item, i) => (<span key={i} className="text-[10px] bg-slate-50 px-2 py-1 rounded border border-slate-200 whitespace-nowrap text-slate-600">{item}</span>))}</div></div>}
                </div>
                <div className="flex flex-col gap-3 justify-center md:w-1/5"><button className="flex items-center justify-center gap-2 w-full py-2.5 text-sm font-bold text-white bg-[#0E3C23] rounded-xl hover:bg-[#092a18] transition-colors shadow-sm"><Clock size={16} />Süreyi Uzat</button><button className="flex items-center justify-center gap-2 w-full py-2.5 text-sm font-bold text-[#0E3C23] bg-emerald-50 rounded-xl hover:bg-emerald-100 transition-colors border border-emerald-100"><ShoppingBag size={16} />Satın Al</button></div>
              </div>
            </div>
          ))
        )}
      </div>
    </div>
  );
}

function CheckoutModal({ isOpen, onClose, items, total, onComplete }) {
  const [step, setStep] = useState(1);
  const [formData, setFormData] = useState({ name: '', phone: '', address: '', city: 'Isparta', cardName: '', cardNumber: '', expiry: '', cvv: '' });
  if (!isOpen) return null;
  const handleSubmit = (e) => { e.preventDefault(); setStep(4); setTimeout(() => onComplete(), 2000); };
  const steps = [{ num: 1, label: 'Sepet' }, { num: 2, label: 'Teslimat' }, { num: 3, label: 'Ödeme' }];
  return (
    <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300"><div className="bg-white rounded-3xl w-full max-w-2xl overflow-hidden shadow-2xl flex flex-col max-h-[90vh]"><div className="bg-[#0E3C23] p-6 text-white flex justify-between items-center"><h3 className="text-xl font-bold flex items-center gap-2"><Wallet className="w-6 h-6 text-emerald-400"/>{step === 4 ? 'İşlem Başarılı' : 'Güvenli Ödeme'}</h3>{step !== 4 && <button onClick={onClose} className="hover:bg-white/10 p-2 rounded-full transition-colors"><X size={24} /></button>}</div>{step !== 4 && (<div className="bg-slate-50 px-8 py-4 border-b border-slate-100"><div className="flex justify-between relative"><div className="absolute top-1/2 left-0 w-full h-0.5 bg-slate-200 -z-10"></div>{steps.map((s) => (<div key={s.num} className="flex flex-col items-center gap-2 bg-slate-50 px-2"><div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold transition-colors ${step >= s.num ? 'bg-emerald-500 text-white' : 'bg-slate-200 text-slate-500'}`}>{step > s.num ? <Check size={16} /> : s.num}</div><span className={`text-xs font-medium ${step >= s.num ? 'text-emerald-600' : 'text-slate-400'}`}>{s.label}</span></div>))}</div></div>)}<div className="p-8 overflow-y-auto flex-1 custom-scrollbar">{step === 1 && (<div className="space-y-6"><h4 className="text-lg font-bold text-slate-800">Seçilen Ürünler & Paketler</h4><div className="space-y-3">{items.map((item, idx) => (<div key={idx} className="flex justify-between items-center p-4 bg-emerald-50/50 border border-emerald-100 rounded-xl"><div className="flex items-center gap-3"><div className="w-10 h-10 bg-white rounded-lg flex items-center justify-center text-emerald-600 shadow-sm">{item.icon || <Package size={20}/>}</div><div><p className="font-bold text-slate-700">{item.name}</p><p className="text-xs text-slate-500">{item.type === 'package' ? 'Paket Aboneliği' : 'Ürün Aboneliği'}</p></div></div><p className="font-bold text-[#0E3C23]">{item.price.toLocaleString('tr-TR')} ₺</p></div>))}</div><div className="flex justify-between items-center pt-4 border-t border-slate-100"><span className="text-slate-500 font-medium">Aylık Toplam Tutar</span><span className="text-2xl font-bold text-[#0E3C23]">{total.toLocaleString('tr-TR')} ₺</span></div><div className="p-4 bg-blue-50 text-blue-700 text-sm rounded-xl border border-blue-100 flex items-start gap-2"><ShieldCheck size={18} className="mt-0.5 shrink-0"/><p>İlk ay ödemesi şimdi alınacaktır. Sonraki ödemeler her ayın aynı günü otomatik tahsil edilir.</p></div></div>)}{step === 2 && (<div className="space-y-4"><h4 className="text-lg font-bold text-slate-800">Teslimat Bilgileri</h4><div className="grid grid-cols-2 gap-4"><div className="col-span-2"><label className="block text-xs font-bold text-slate-500 mb-1">Ad Soyad</label><input type="text" className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none" placeholder="Teslim alacak kişi" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} /></div><div className="col-span-2 md:col-span-1"><label className="block text-xs font-bold text-slate-500 mb-1">Telefon</label><input type="tel" className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none" placeholder="0555 555 55 55" value={formData.phone} onChange={e => setFormData({...formData, phone: e.target.value})} /></div><div className="col-span-2 md:col-span-1"><label className="block text-xs font-bold text-slate-500 mb-1">Şehir (Pilot Bölge)</label><select className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none" value={formData.city} onChange={e => setFormData({...formData, city: e.target.value})}><option value="Isparta">Isparta</option><option value="Antalya">Antalya</option><option value="Burdur">Burdur</option></select></div><div className="col-span-2"><label className="block text-xs font-bold text-slate-500 mb-1">Açık Adres</label><textarea className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none h-24 resize-none" placeholder="Mahalle, sokak, bina no..." value={formData.address} onChange={e => setFormData({...formData, address: e.target.value})}></textarea></div></div></div>)}{step === 3 && (<form onSubmit={handleSubmit} className="space-y-6"><h4 className="text-lg font-bold text-slate-800">Kart Bilgileri</h4><div className="bg-gradient-to-br from-slate-800 to-slate-900 p-6 rounded-2xl text-white shadow-lg mb-6 relative overflow-hidden"><div className="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full -translate-y-1/2 translate-x-1/3"></div><div className="flex justify-between items-start mb-8"><div className="bg-white/20 w-12 h-8 rounded-md"></div><p className="text-xs text-slate-400 font-mono">CREDIT CARD</p></div><p className="text-xl font-mono tracking-widest mb-4">{formData.cardNumber || '0000 0000 0000 0000'}</p><div className="flex justify-between items-end"><div><p className="text-[10px] text-slate-400 uppercase">Kart Sahibi</p><p className="font-medium uppercase tracking-wide">{formData.cardName || 'AD SOYAD'}</p></div><div><p className="text-[10px] text-slate-400 uppercase">SKT</p><p className="font-medium">{formData.expiry || 'MM/YY'}</p></div></div></div><div className="space-y-4"><div><label className="block text-xs font-bold text-slate-500 mb-1">Kart Numarası</label><div className="relative"><CreditCard className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" size={18} /><input type="text" className="w-full pl-10 p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none" placeholder="0000 0000 0000 0000" maxLength={19} value={formData.cardNumber} onChange={e => setFormData({...formData, cardNumber: e.target.value})} /></div></div><div className="grid grid-cols-2 gap-4"><div><label className="block text-xs font-bold text-slate-500 mb-1">Son Kullanma (Ay/Yıl)</label><input type="text" className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none" placeholder="MM/YY" maxLength={5} value={formData.expiry} onChange={e => setFormData({...formData, expiry: e.target.value})} /></div><div><label className="block text-xs font-bold text-slate-500 mb-1">CVV</label><input type="text" className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none" placeholder="123" maxLength={3} value={formData.cvv} onChange={e => setFormData({...formData, cvv: e.target.value})} /></div></div><div><label className="block text-xs font-bold text-slate-500 mb-1">Kart Üzerindeki İsim</label><input type="text" className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none" placeholder="Ad Soyad" value={formData.cardName} onChange={e => setFormData({...formData, cardName: e.target.value})} /></div></div></form>)}{step === 4 && (<div className="flex flex-col items-center justify-center h-full py-10 text-center"><div className="w-24 h-24 bg-emerald-100 rounded-full flex items-center justify-center mb-6 animate-bounce"><CheckCircle className="w-12 h-12 text-emerald-600" /></div><h3 className="text-2xl font-bold text-[#0E3C23] mb-2">Aboneliğiniz Başladı!</h3><p className="text-slate-500 max-w-sm mx-auto">Siparişiniz başarıyla oluşturuldu. Ürünleriniz en kısa sürede hazırlanıp adresinize kargolanacaktır.</p><div className="mt-8 w-full bg-slate-50 p-4 rounded-xl border border-slate-100"><p className="text-sm text-slate-500 mb-1">Sipariş Numarası</p><p className="font-mono font-bold text-lg text-slate-800">#AYM-{Math.floor(Math.random() * 100000)}</p></div></div>)}</div>{step !== 4 && (<div className="p-6 border-t border-slate-100 bg-slate-50 flex justify-between items-center">{step > 1 ? <button onClick={() => setStep(p => p - 1)} className="text-slate-500 hover:text-slate-800 font-medium px-4 py-2">Geri Dön</button> : <div></div>}<button onClick={step === 3 ? handleSubmit : () => setStep(p => p + 1)} className="bg-[#0E3C23] hover:bg-[#092a18] text-white px-8 py-3 rounded-xl font-bold shadow-lg shadow-emerald-900/20 transition-all flex items-center gap-2">{step === 3 ? 'Ödemeyi Tamamla' : 'Devam Et'}<ArrowRight size={18} /></button></div>)}</div></div>
  );
}

// --- ANA UYGULAMA ---
export default function App() {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [isSignUp, setIsSignUp] = useState(true);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');
  const [message, setMessage] = useState('');
  const [user, setUser] = useState(null);
  
  const [showContractModal, setShowContractModal] = useState(false);
  const [showFaqModal, setShowFaqModal] = useState(false);
  const [isCheckoutOpen, setIsCheckoutOpen] = useState(false);
  const [currentView, setCurrentView] = useState('dashboard');
  
  const [selections, setSelections] = useState({});
  const [selectedPlanId, setSelectedPlanId] = useState(null);
  const [customPlanSelections, setCustomPlanSelections] = useState({});
  const [orders, setOrders] = useState(INITIAL_ORDERS);

  useEffect(() => {
    if (!auth) return;
    const unsubscribe = onAuthStateChanged(auth, (currentUser) => setUser(currentUser));
    return () => unsubscribe();
  }, []);

  const handleGoogleSignIn = async () => { if (!auth) { setError("Firebase yapılandırılmadı."); return; } setLoading(true); setError(''); const provider = new GoogleAuthProvider(); try { await signInWithPopup(auth, provider); } catch (err) { setError('Hata: ' + err.message); } finally { setLoading(false); } };
  const handleEmailAuth = async (e) => { e.preventDefault(); if (!auth) { setError("Firebase yapılandırılmadı."); return; } setLoading(true); setError(''); setMessage(''); try { if (isSignUp) { const userCredential = await createUserWithEmailAndPassword(auth, email, password); await sendEmailVerification(userCredential.user); setMessage('Doğrulama e-postası gönderildi!'); } else { await signInWithEmailAndPassword(auth, email, password); } } catch (err) { setError(err.message.replace('Firebase: ', '')); } finally { setLoading(false); } };
  const handleDemoLogin = () => { setLoading(true); setTimeout(() => { setUser({ email: 'misafir@aymibox.com', uid: 'demo-123' }); setLoading(false); }, 800); };
  const handleSignOut = async () => { if (auth) { await signOut(auth); } setUser(null); setSelections({}); setSelectedPlanId(null); setCustomPlanSelections({}); setCurrentView('dashboard'); };
  
  const handleProductSelect = (productId, model) => setSelections(prev => { const newSelections = { ...prev }; if (model === null) delete newSelections[productId]; else newSelections[productId] = model; return newSelections; });
  const handlePlanSelect = (planId) => setSelectedPlanId(prev => prev === planId ? null : planId);
  const handleCustomPlanUpdate = (category, option) => setCustomPlanSelections(prev => { const newState = { ...prev }; if (option === null) delete newState[category]; else newState[category] = option; return newState; });

  const productsPrice = Object.values(selections).reduce((sum, item) => sum + item.price, 0);
  let planPrice = 0;
  if (selectedPlanId) { if (selectedPlanId === 'custom') planPrice = Object.values(customPlanSelections).reduce((sum, item) => sum + item.price, 0); else { const plan = PLANS.find(p => p.id === selectedPlanId); planPrice = plan ? plan.price : 0; } }
  const finalTotalPrice = productsPrice + planPrice;
  const finalTotalItems = Object.keys(selections).length + (selectedPlanId ? 1 : 0);

  const handleStartCheckout = () => { if (finalTotalItems === 0) { alert("Lütfen önce bir ürün veya paket seçin."); return; } setIsCheckoutOpen(true); };
  
  const getCartItems = () => {
    const items = [];
    Object.values(selections).forEach(item => items.push({ name: item.name, price: item.price, type: 'product', icon: null }));
    if (selectedPlanId) {
      if (selectedPlanId === 'custom') {
        const price = Object.values(customPlanSelections).reduce((s, i) => s + i.price, 0);
        items.push({ name: 'KENDİ PLANIN', price: price, type: 'package', icon: <LayoutGrid size={20}/> });
      } else {
        const plan = PLANS.find(p => p.id === selectedPlanId);
        items.push({ name: plan.name, price: plan.price, type: 'package', icon: <LayoutGrid size={20}/> });
      }
    }
    return items;
  };

  const handlePaymentComplete = () => {
    const newOrders = [];
    const today = new Date();
    const nextYear = new Date(new Date().setFullYear(today.getFullYear() + 1));
    Object.values(selections).forEach(item => newOrders.push({ id: `ord-${Math.floor(Math.random() * 10000)}`, type: 'product', name: item.name, category: 'Tekil Ürün', price: item.price, startDate: today.toLocaleDateString('tr-TR'), endDate: nextYear.toLocaleDateString('tr-TR'), status: 'active', icon: <Package size={24} />, progress: 0 }));
    if (selectedPlanId) {
      let planName = '', planItems = [], price = 0;
      if (selectedPlanId === 'custom') { planName = 'KENDİ PLANIN'; planItems = Object.values(customPlanSelections).map(i => i.name); price = Object.values(customPlanSelections).reduce((s, i) => s + i.price, 0); } 
      else { const plan = PLANS.find(p => p.id === selectedPlanId); planName = plan.name; planItems = plan.includedProducts; price = plan.price; }
      newOrders.push({ id: `ord-${Math.floor(Math.random() * 10000)}`, type: 'package', name: planName, category: 'Abonelik Paketi', price: price, startDate: today.toLocaleDateString('tr-TR'), endDate: nextYear.toLocaleDateString('tr-TR'), status: 'active', icon: <LayoutGrid size={24} />, progress: 0, items: planItems });
    }
    setOrders(prev => [...newOrders, ...prev]);
    setSelections({}); setSelectedPlanId(null); setCustomPlanSelections({}); setIsCheckoutOpen(false); setCurrentView('orders');
  };

  // Modallar (Contract, FAQ)
  const ContractModal = () => (<div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200"><div className="bg-white rounded-3xl w-full max-w-3xl max-h-[85vh] overflow-hidden flex flex-col shadow-2xl transform transition-all"><div className="p-6 border-b border-slate-100 flex justify-between items-center bg-[#0E3C23] text-white sticky top-0 z-10"><div className="flex items-center gap-3"><FileText className="w-6 h-6 text-emerald-400" /><h3 className="text-xl font-bold">Aymibox Üyelik Sözleşmesi</h3></div><button onClick={() => setShowContractModal(false)} className="p-2 hover:bg-white/10 rounded-full transition-colors text-emerald-200 hover:text-white"><X size={24}/></button></div><div className="p-8 overflow-y-auto text-slate-600 text-sm leading-relaxed space-y-6 font-light custom-scrollbar"><div className="p-4 bg-emerald-50 rounded-xl border border-emerald-100 mb-6"><p className="font-medium text-[#0E3C23]">Bu üyelik sözleşmesi (“Sözleşme”), Isparta / Türkiye adresinde şahıs şirketi olarak faaliyet gösteren Hüseyin Çakır (“Aymibox”) ile www.aymibox.com internet sitesine (“Web Sitesi”) üye olan kullanıcı (“Üye”) arasında elektronik ortamda akdedilmiştir.</p><p className="mt-2">Aymibox ve Üye bundan böyle tek başına “Taraf” ve birlikte “Taraflar” olarak anılır.</p><p className="mt-2">Bu Sözleşme’nin kurulması için, Üye’nin gerekli bilgileri doğru ve eksiksiz şekilde doldurması, açık rızaları işaretlemesi ve “Üye Ol” butonuna basması yeterlidir.</p><p className="mt-2">Aymibox, istediği zaman bu Sözleşme’yi tek taraflı olarak değiştirme hakkını saklı tutar.</p></div><div className="space-y-4"><h4 className="text-lg font-bold text-[#0E3C23] border-b border-slate-200 pb-2">1. Sözleşmenin Konusu</h4><p>Bu Sözleşme, Üye’nin Web Sitesi’ne üyelik olması, Web Sitesi’ni ve Aymibox ürün kiralama hizmetlerini kullanması sırasında Taraflar’ın hak ve yükümlülüklerini düzenler.</p></div><div className="space-y-4"><h4 className="text-lg font-bold text-[#0E3C23] border-b border-slate-200 pb-2">2. Üye Yükümlülükleri</h4><ul className="space-y-2"><li><strong>2.1</strong> Üye, üyelik formunu doldurarak; Aymibox Kurallarını, Açık Rıza Metni’ni, Gizlilik Politikasını okuduğunu, anladığını ve bunlara aykırı olmayacağını kabul eder.</li><li><strong>2.2</strong> Üye, 18 yaşından büyük olduğunu beyan eder.</li><li><strong>2.3</strong> Üye, üyelikte beyan ettiği TC Kimlik No, doğum tarihi, ad-soyad, e-posta, telefon dahil tüm bilgilerin doğru olduğunu, yanlış bilgi verilmesi halinde doğabilecek tüm zararlardan sorumlu olduğunu kabul eder.</li><li><strong>2.4</strong> Üye, oluşturduğu şifrenin gizliliğinden sorumludur.</li><li><strong>2.5</strong> Üye, ödemeleri kendi kartı veya kart sahibinin izni ile yapacağını kabul eder.</li></ul></div><div className="space-y-4"><h4 className="text-lg font-bold text-[#0E3C23] border-b border-slate-200 pb-2">3. Web Sitesi Kullanımı</h4><ul className="space-y-2"><li><strong>3.1</strong> Üye, Web Sitesi’ne zarar verecek her türlü işlemden uzak duracağını kabul eder.</li><li><strong>3.2</strong> Üye, genel ahlaka ve hukuka aykırı içerik paylaşamaz.</li><li><strong>3.3</strong> Web Sitesi’ne ait tüm yazılım ve tasarım hakları Aymibox’a aittir.</li><li><strong>3.4</strong> Üye, istenmeyen tanıtım yapamaz.</li><li><strong>3.5</strong> Aymibox hizmeti durdurma hakkına sahiptir.</li><li><strong>3.6</strong> Aymibox şartları güncelleyebilir.</li></ul></div><div className="space-y-4"><h4 className="text-lg font-bold text-[#0E3C23] border-b border-slate-200 pb-2">4. Kişisel Verilerin Korunması</h4><p>Üye, üyelik oluşturarak Aymibox Gizlilik Politikası’nı kabul etmiş sayılır.</p></div><div className="space-y-4"><h4 className="text-lg font-bold text-[#0E3C23] border-b border-slate-200 pb-2">5. Sorumluluk Reddi</h4><ul className="space-y-2"><li><strong>5.1</strong> Aymibox, içerik ve teknik verilerin doğruluğunu garanti etmez.</li><li><strong>5.2</strong> Üçüncü taraf linklerinden sorumlu değildir.</li></ul></div><div className="space-y-4"><h4 className="text-lg font-bold text-[#0E3C23] border-b border-slate-200 pb-2">6. Sözleşmenin Süresi ve Feshi</h4><p>Üye onayı ile başlar, taraflar istediği zaman feshedebilir.</p></div><div className="space-y-4"><h4 className="text-lg font-bold text-[#0E3C23] border-b border-slate-200 pb-2">7. Feragat Etmeme</h4><p>Geçici kullanmama feragat anlamına gelmez.</p></div><div className="space-y-4"><h4 className="text-lg font-bold text-[#0E3C23] border-b border-slate-200 pb-2">8. Bölünebilirlik</h4><p>Bir madde geçersiz olsa dahi diğerleri geçerlidir.</p></div><div className="space-y-4"><h4 className="text-lg font-bold text-[#0E3C23] border-b border-slate-200 pb-2">9. Mücbir Sebep</h4><p>Doğal afet vb. durumlarda sorumluluk kalkar.</p></div><div className="space-y-4"><h4 className="text-lg font-bold text-[#0E3C23] border-b border-slate-200 pb-2">10. Sözleşme Değişikliği</h4><p>Aymibox sözleşmeyi güncelleyebilir.</p></div><div className="space-y-4"><h4 className="text-lg font-bold text-[#0E3C23] border-b border-slate-200 pb-2">11. Tebligat</h4><p>E-posta adresi yasal tebligat adresidir.</p></div><div className="space-y-4"><h4 className="text-lg font-bold text-[#0E3C23] border-b border-slate-200 pb-2">12. Hukuk ve Yetki</h4><p>Türk hukuku geçerlidir. Isparta veya İstanbul Mahkemeleri yetkilidir.</p></div><div className="space-y-4"><h4 className="text-lg font-bold text-[#0E3C23] border-b border-slate-200 pb-2">13. Delil Anlaşması</h4><p>Sistem kayıtları kesin delildir.</p></div></div><div className="p-5 border-t border-slate-100 bg-slate-50 flex justify-end sticky bottom-0 z-10"><button onClick={() => setShowContractModal(false)} className="bg-[#0E3C23] text-white px-8 py-3 rounded-xl hover:bg-[#092a18] transition-all font-semibold shadow-lg shadow-green-900/10">Okudum, Kapat</button></div></div></div>);
  const FaqModal = () => (<div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200"><div className="bg-white rounded-3xl w-full max-w-3xl max-h-[85vh] overflow-hidden flex flex-col shadow-2xl transform transition-all"><div className="p-6 border-b border-slate-100 flex justify-between items-center bg-[#0E3C23] text-white sticky top-0 z-10"><div className="flex items-center gap-3"><HelpCircle className="w-6 h-6 text-emerald-400" /><h3 className="text-xl font-bold">Sıkça Sorulan Sorular</h3></div><button onClick={() => setShowFaqModal(false)} className="p-2 hover:bg-white/10 rounded-full transition-colors text-emerald-200 hover:text-white"><X size={24}/></button></div><div className="p-8 overflow-y-auto text-slate-600 text-sm leading-relaxed space-y-6 custom-scrollbar"><div className="space-y-2"><h4 className="text-base font-bold text-[#0E3C23]">Kiralama ile abonelik arasındaki fark nedir?</h4><p>Kiralama tek seferlik yapılan ödeme ile başlar; abonelik ise seçilen süre boyunca aylık otomatik ödeme ile devam eden bir taahhüttür.</p></div><div className="space-y-2"><h4 className="text-base font-bold text-[#0E3C23]">Kiralamadan aboneliğe geçebilir miyim?</h4><p>Evet. Tek seferlik kiralama yaptığın ürünü daha sonra abonelik sistemine geçirebilirsin.</p></div><div className="space-y-2"><h4 className="text-base font-bold text-[#0E3C23]">Abonelikten kiralamaya geçebilir miyim?</h4><p>Evet. Abonelik süresinin bitiminde ürünü tek seferlik kiralama sistemine çevirebilirsin.</p></div><div className="space-y-2"><h4 className="text-base font-bold text-[#0E3C23] flex items-center gap-2"><MapPin size={16}/> Hangi şehirlerde hizmet veriyorsunuz?</h4><p className="bg-emerald-50 p-3 rounded-lg border border-emerald-100 text-emerald-800 font-medium inline-block">Pilot bölge olarak: Isparta, Antalya, Burdur</p></div><div className="space-y-2"><h4 className="text-base font-bold text-[#0E3C23]">Aboneliğimi erken sonlandırabilir miyim?</h4><p>Hayır. Abonelik, seçilen süre boyunca kullanım taahhüdüdür. Erken iptal edilemez.</p></div></div><div className="p-5 border-t border-slate-100 bg-slate-50 flex justify-end sticky bottom-0 z-10"><button onClick={() => setShowFaqModal(false)} className="bg-[#0E3C23] text-white px-8 py-3 rounded-xl hover:bg-[#092a18] transition-all font-semibold shadow-lg shadow-green-900/10">Anladım, Kapat</button></div></div></div>);

  if (user) {
    return (
      <div className="min-h-screen bg-slate-50 font-sans text-slate-800 pb-32 flex flex-col">
        {showContractModal && <ContractModal />}
        {showFaqModal && <FaqModal />}
        {isCheckoutOpen && <CheckoutModal isOpen={isCheckoutOpen} onClose={() => setIsCheckoutOpen(false)} items={getCartItems()} total={finalTotalPrice} onComplete={handlePaymentComplete} />}
        
        <header className="bg-white border-b border-slate-200 sticky top-0 z-40"><div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between"><div className="flex items-center gap-2 cursor-pointer" onClick={() => setCurrentView('dashboard')}><div className="w-8 h-8 bg-[#0E3C23] rounded-lg flex items-center justify-center transform -rotate-3"><span className="text-white font-bold text-xs">aymi</span></div><h1 className="text-xl font-bold text-[#0E3C23] tracking-tight">Aymibox</h1></div><div className="flex items-center gap-2 md:gap-4"><div className="hidden md:flex gap-2 mr-4"><button onClick={() => setCurrentView('dashboard')} className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${currentView === 'dashboard' ? 'bg-emerald-50 text-[#0E3C23]' : 'text-slate-600 hover:bg-slate-50'}`}>Ana Sayfa</button><button onClick={() => setCurrentView('orders')} className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 ${currentView === 'orders' ? 'bg-emerald-50 text-[#0E3C23]' : 'text-slate-600 hover:bg-slate-50'}`}><Package size={16} />Siparişlerim</button></div><div className="flex items-center gap-3 pl-4 border-l border-slate-200"><span className="hidden md:block text-sm text-slate-500">{user.email}</span><button onClick={handleSignOut} className="text-sm font-medium text-red-600 hover:text-red-700 hover:bg-red-50 px-3 py-1.5 rounded-lg transition-colors">Çıkış</button></div></div></div></header>
        
        <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 flex-grow">
          {currentView === 'orders' ? <OrdersView orders={orders} /> : (
            <>
              <div className="mb-12 flex items-end justify-between flex-wrap gap-4"><div><h2 className="text-3xl font-bold text-[#0E3C23] mb-3">Eviniz ve ofisiniz için</h2><p className="text-slate-500 text-lg">Abonelik sistemiyle dilediğiniz ürünü hemen kullanmaya başlayın.</p></div><div className="bg-emerald-50 px-4 py-2 rounded-lg border border-emerald-100 text-[#0E3C23] text-sm font-medium flex items-center gap-2"><Calendar className="w-4 h-4" /><span>Aylık Abonelik Planları</span></div></div>
              <div className="bg-white rounded-3xl p-8 md:p-12 shadow-sm border border-slate-100 mb-16"><div className="text-center mb-12"><span className="text-emerald-600 font-bold tracking-wider uppercase text-xs bg-emerald-50 px-3 py-1 rounded-full">Sistem Nasıl İşliyor?</span></div><div className="grid grid-cols-1 md:grid-cols-4 gap-12 relative"><HowItWorksStep icon={<MousePointer2 className="w-8 h-8" />} title="Ürününü Seç" description="Kiralamak istediğin ürünü veya paketi aşağıdaki listeden seç." showArrow={true} /><HowItWorksStep icon={<Package className="w-8 h-8" />} title="Adresine Gelsin" description="Ürününü kargo ile kapına kadar ücretsiz teslim edelim." showArrow={true} /><HowItWorksStep icon={<Armchair className="w-8 h-8" />} title="Kullanmaya Başla" description="Belirlediğin süre boyunca ürünün keyfini çıkar." showArrow={true} /><HowItWorksStep icon={<Clock className="w-8 h-8" />} title="Karar Ver" description="Süre sonunda kiralamanı bitir, uzat veya ürünü satın al." showArrow={false} /></div></div>
              <FlexibilitySection />
              <div className="mb-20"><div className="flex items-center justify-between mb-8"><h3 className="text-2xl font-bold text-[#0E3C23]">Ürünleri Tek Tek Seç</h3><div className="h-px bg-slate-200 flex-1 ml-6"></div></div><div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">{PRODUCTS.map(product => (<ProductCard key={product.id} product={product} selectedModel={selections[product.id]} onSelect={handleProductSelect} />))}</div></div>
              <div className="mb-12"><div className="flex items-center justify-between mb-8"><h3 className="text-2xl font-bold text-[#0E3C23]">Avantajlı Abonelik Paketleri</h3><div className="h-px bg-slate-200 flex-1 ml-6"></div></div><div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6">{PLANS.map(plan => (<PlanCard key={plan.id} plan={plan} isSelected={selectedPlanId === plan.id} onSelect={handlePlanSelect} customSelections={plan.id === 'custom' ? customPlanSelections : null} onCustomUpdate={handleCustomPlanUpdate} />))}</div></div>
            </>
          )}
        </main>

        <footer className="bg-[#0E3C23] text-white py-20 mt-12 rounded-t-[3rem] relative overflow-hidden">
          <div className="absolute top-0 left-0 w-full h-full opacity-10 bg-[radial-gradient(circle_at_top_right,_var(--tw-gradient-stops))] from-emerald-400 via-[#0E3C23] to-transparent pointer-events-none"></div>
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-16 mb-20">
               <div className="space-y-6"><div className="inline-flex items-center gap-2 bg-emerald-900/50 px-3 py-1 rounded-full text-emerald-300 text-xs font-bold uppercase tracking-wider border border-emerald-800/50"><Sparkles size={14} /> Hakkımızda</div><h2 className="text-3xl md:text-4xl font-bold leading-tight">Kullan, yenile, dönüştür. <br/><span className="text-emerald-400">Sahip olmak zorunda değilsin.</span></h2><p className="text-emerald-100/80 text-lg leading-relaxed">Aymibox, ev veya ofis kurmanın yükünü ortadan kaldırmak için kurulmuş yeni nesil bir abonelik ve kiralama platformudur.</p></div>
               <div className="bg-[#092315] p-8 rounded-3xl border border-emerald-900/50"><h3 className="text-xl font-bold mb-6 flex items-center gap-2"><ShieldCheck className="text-emerald-400" /> Neden Aymibox?</h3><div className="grid grid-cols-1 sm:grid-cols-2 gap-6"><div className="flex items-start gap-3"><div className="bg-emerald-900 p-2 rounded-lg text-emerald-400"><Wallet size={20}/></div><div><h4 className="font-bold text-sm">Peşinat Yok</h4><p className="text-xs text-emerald-100/60 mt-1">Ürün almak için toplu ödeme yapmazsın.</p></div></div><div className="flex items-start gap-3"><div className="bg-emerald-900 p-2 rounded-lg text-emerald-400"><Calendar size={20}/></div><div><h4 className="font-bold text-sm">Sabit Aylık Ücret</h4><p className="text-xs text-emerald-100/60 mt-1">Beklenmedik sürpriz masraflar yok.</p></div></div><div className="flex items-start gap-3"><div className="bg-emerald-900 p-2 rounded-lg text-emerald-400"><LayoutGrid size={20}/></div><div><h4 className="font-bold text-sm">Kendi Paketini Yap</h4><p className="text-xs text-emerald-100/60 mt-1">Minimum 3 ürün seç, fiyatını anında gör.</p></div></div><div className="flex items-start gap-3"><div className="bg-emerald-900 p-2 rounded-lg text-emerald-400"><RefreshCcw size={20}/></div><div><h4 className="font-bold text-sm">Bakım & Değişim</h4><p className="text-xs text-emerald-100/60 mt-1">Teknik sorunlarla biz ilgileniyoruz.</p></div></div></div></div>
            </div>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-8 border-t border-emerald-800/50 pt-12"><div className="space-y-3"><h4 className="text-lg font-bold text-emerald-400 flex items-center gap-2"><Zap size={18}/> Misyonumuz</h4><p className="text-sm text-emerald-100/70 leading-relaxed">İnsanlara hem ekonomik hem esnek hem de sürdürülebilir bir yaşam deneyimi sunmak.</p></div><div className="space-y-3"><h4 className="text-lg font-bold text-emerald-400 flex items-center gap-2"><Globe size={18}/> Vizyonumuz</h4><p className="text-sm text-emerald-100/70 leading-relaxed">Türkiye’de kiralama ve abonelik kültürünü yeniden tanımlayan marka olmak.</p></div><div className="space-y-3"><h4 className="text-lg font-bold text-emerald-400 flex items-center gap-2"><Star size={18}/> Değerlerimiz</h4><ul className="text-sm text-emerald-100/70 space-y-1"><li><strong className="text-emerald-200">Şeffaflık:</strong> Ücret ve süreçler net.</li><li><strong className="text-emerald-200">Güven:</strong> Findeks doğrulamalı sistem.</li></ul></div></div>
            <div className="mt-16 border-t border-emerald-900 pt-8 flex flex-col md:flex-row justify-between items-center gap-4"><p className="text-xs text-emerald-800 font-medium">© 2024 Aymibox Teknoloji A.Ş. Tüm hakları saklıdır.</p><div className="flex gap-6"><button onClick={() => setShowContractModal(true)} className="text-xs text-emerald-400 hover:text-white underline transition-colors flex items-center gap-1"><FileText size={12} />Üyelik Sözleşmesi</button><button onClick={() => setShowFaqModal(true)} className="text-xs text-emerald-400 hover:text-white underline transition-colors flex items-center gap-1"><HelpCircle size={12} />Sıkça Sorulan Sorular</button></div></div>
          </div>
        </footer>

        {currentView === 'dashboard' && (
          <div className="fixed bottom-0 left-0 w-full bg-white border-t border-slate-200 shadow-[0_-4px_20px_rgba(0,0,0,0.05)] z-50"><div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex flex-col sm:flex-row items-center justify-between gap-4"><div className="flex items-center gap-4 w-full sm:w-auto"><div className="w-12 h-12 bg-emerald-100 rounded-full flex items-center justify-center text-[#0E3C23]"><ShoppingCart className="w-6 h-6" /></div><div><p className="text-sm text-slate-500 font-medium">{finalTotalItems} Ürün/Paket</p><p className="text-2xl font-bold text-[#0E3C23]">{finalTotalPrice.toLocaleString('tr-TR')} ₺<span className="text-sm font-normal text-slate-400">/Ay</span></p></div></div><div className="flex gap-3 w-full sm:w-auto"><div className="hidden sm:block text-right mr-4"><p className="text-xs text-slate-400">Aylık Toplam</p><p className="text-xs text-slate-400 font-light">KDV Dahil</p></div><button onClick={handleStartCheckout} className="flex-1 sm:flex-none bg-[#0E3C23] hover:bg-[#092a18] text-white px-8 py-3 rounded-xl font-semibold shadow-lg shadow-green-900/20 transition-transform hover:-translate-y-1 active:translate-y-0">Aboneliği Başlat</button></div></div></div>
        )}
        
        <style>{`
          .perspective-1000 { perspective: 1000px; }
          .transform-style-3d { transform-style: preserve-3d; }
          .backface-hidden { backface-visibility: hidden; }
          .rotate-y-180 { transform: rotateY(180deg); }
          .custom-scrollbar::-webkit-scrollbar { width: 6px; }
          .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
          .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
        `}</style>
      </div>
    );
  }

  return (
    <div className="min-h-screen flex flex-col md:flex-row font-sans text-gray-800">
      <div className="w-full md:w-1/2 bg-slate-900 text-white flex flex-col justify-center items-center p-12 relative overflow-hidden">
        <div className="absolute top-0 left-0 w-full h-full bg-gradient-to-br from-[#0E3C23] to-slate-900 opacity-90 z-0"></div>
        <div className="absolute w-96 h-96 bg-[#0E3C23] rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob"></div>
        <div className="relative z-10 text-center flex flex-col items-center"><div className="w-24 h-24 bg-green-500 rounded-3xl shadow-2xl shadow-green-900/50 flex flex-col items-center justify-center leading-none mb-8 transform -rotate-3 hover:rotate-0 transition-transform duration-500 cursor-default border-b-8 border-r-8 border-green-600"><span className="text-[#0E3C23] font-extrabold text-3xl tracking-tight">aymi</span><span className="text-white font-extrabold text-3xl tracking-tight">box</span></div><h2 className="text-3xl md:text-5xl font-bold mb-6 leading-tight">İster kirala, <br /><span className="text-emerald-400">ister satın al.</span></h2><p className="text-slate-300 text-lg max-w-md mx-auto leading-relaxed font-medium">Yüksek peşinat ödemeden evinizi, ofisinizi donatmanın akıllı yolu.</p></div>
        <div className="absolute bottom-8 text-slate-500 text-sm z-20">© 2024 Aymibox</div>
      </div>
      <div className="w-full md:w-1/2 bg-white flex items-center justify-center p-8 md:p-16">
        <div className="w-full max-w-md">
          <div className="mb-8"><h3 className="text-3xl font-bold text-slate-900 mb-2">{isSignUp ? 'Hesap Oluştur' : 'Tekrar Hoş Geldin'}</h3><p className="text-slate-500">{isSignUp ? 'Başlamak için bilgilerinizi girin.' : 'Hesabınıza erişmek için giriş yapın.'}</p></div>
          <button onClick={handleGoogleSignIn} disabled={loading} className="w-full flex items-center justify-center gap-3 bg-white border border-slate-200 hover:bg-slate-50 text-slate-700 font-medium py-3 px-4 rounded-xl transition-all shadow-sm hover:shadow mb-6 group"><svg className="w-5 h-5" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" /><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" /><path fill="#FBBC05" d="M5.84 14.17c-.22-.66-.35-1.36-.35-2.17s.13-1.51.35-2.17V7.01H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.99l3.66-2.82z" /><path fill="#EA4335" d="M12 4.8c1.6 0 3.06.55 4.21 1.64l3.16-3.16C17.45 1.49 14.97 0 12 0 7.7 0 3.99 2.47 2.18 7.01l3.66 2.82c.87-2.6 3.3-4.53 6.16-4.53z" /></svg><span className="group-hover:text-slate-900">Google ile devam et</span></button>
          <div className="relative flex items-center gap-4 mb-6"><div className="h-px bg-slate-200 flex-1"></div><span className="text-slate-400 text-sm font-medium">VEYA E-POSTA İLE</span><div className="h-px bg-slate-200 flex-1"></div></div>
          <form onSubmit={handleEmailAuth} className="space-y-4">
            <div><label className="block text-sm font-medium text-slate-700 mb-1.5">E-posta Adresi</label><div className="relative"><Mail className="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-5 h-5" /><input type="email" required value={email} onChange={(e) => setEmail(e.target.value)} className="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-[#0E3C23] focus:border-transparent outline-none transition-all" placeholder="ornek@sirket.com"/></div></div>
            <div><label className="block text-sm font-medium text-slate-700 mb-1.5">Şifre</label><div className="relative"><Lock className="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-5 h-5" /><input type="password" required value={password} onChange={(e) => setPassword(e.target.value)} className="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-[#0E3C23] focus:border-transparent outline-none transition-all" placeholder="••••••••"/></div></div>
            {error && <div className="p-3 rounded-lg bg-red-50 text-red-600 text-sm border border-red-100">{error}</div>}
            {message && <div className="p-3 rounded-lg bg-green-50 text-green-600 text-sm border border-green-100">{message}</div>}
            <button type="submit" disabled={loading} className="w-full bg-[#0E3C23] hover:bg-[#092a18] text-white font-semibold py-3.5 px-4 rounded-xl shadow-lg shadow-green-900/20 transition-all flex items-center justify-center gap-2 hover:-translate-y-px">{loading ? 'İşlem Yapılıyor...' : (isSignUp ? 'Hemen Kayıt Ol' : 'Giriş Yap')}{!loading && <ArrowRight className="w-5 h-5" />}</button>
          </form>
          <div className="mt-8 text-center space-y-4">
            <p className="text-slate-500">{isSignUp ? 'Zaten bir hesabın var mı?' : 'Hesabın yok mu?'}<button onClick={() => setIsSignUp(!isSignUp)} className="ml-2 text-[#0E3C23] font-semibold hover:text-[#092a18] transition-colors">{isSignUp ? 'Giriş Yap' : 'Kayıt Ol'}</button></p>
            <button onClick={handleDemoLogin} className="text-slate-400 text-sm hover:text-[#0E3C23] flex items-center justify-center gap-2 w-full transition-colors"><Eye className="w-4 h-4" />Giriş Yapmadan İncele (Demo)</button>
          </div>
        </div>
      </div>
    </div>
  );
}